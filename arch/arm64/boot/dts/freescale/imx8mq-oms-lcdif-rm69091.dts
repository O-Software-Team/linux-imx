// SPDX-License-Identifier: GPL-2.0
/*
 * Copyright 2024 Ocompany.
 */

#include "imx8mq-evk.dts"

/ {
	pmic_osc: clock-pmic {
		compatible = "fixed-clock";
		#clock-cells = <0>;
		clock-frequency = <32768>;
		clock-output-names = "pmic_osc";
	};
};

&i2c1 {
	clock-frequency = <100000>;
	pinctrl-names = "default";
	pinctrl-0 = <&pinctrl_i2c1>;
	status = "okay";

	pmic: pmic@4b {
		compatible = "rohm,bd71837";
		reg = <0x4b>;
		pinctrl-names = "default";
		pinctrl-0 = <&pinctrl_pmic>;
		clocks = <&pmic_osc>;
		clock-names = "osc";
		#clock-cells = <0>;
		clock-output-names = "pmic_clk";
		interrupt-parent = <&gpio1>;
		interrupts = <3 IRQ_TYPE_LEVEL_LOW>;
		rohm,reset-snvs-powered;

		regulators {
			buck1_reg: BUCK1 {
				regulator-name = "buck1";
				regulator-min-microvolt = <700000>;
				regulator-max-microvolt = <1300000>;
				regulator-boot-on;
				regulator-always-on;
				regulator-ramp-delay = <1250>;
				rohm,dvs-run-voltage = <900000>;
				rohm,dvs-idle-voltage = <850000>;
				rohm,dvs-suspend-voltage = <800000>;
			};

			buck2_reg: BUCK2 {
				regulator-name = "buck2";
				regulator-min-microvolt = <700000>;
				regulator-max-microvolt = <1300000>;
				regulator-boot-on;
				regulator-always-on;
				regulator-ramp-delay = <1250>;
				rohm,dvs-run-voltage = <1000000>;
				rohm,dvs-idle-voltage = <900000>;
			};

			buck3_reg: BUCK3 {
				regulator-name = "buck3";
				regulator-min-microvolt = <700000>;
				regulator-max-microvolt = <1300000>;
				regulator-always-on;
				regulator-boot-on;
				rohm,dvs-run-voltage = <900000>;
			};

			buck4_reg: BUCK4 {
				regulator-name = "buck4";
				regulator-min-microvolt = <700000>;
				regulator-max-microvolt = <1300000>;
				rohm,dvs-run-voltage = <1000000>;
			};

			buck5_reg: BUCK5 {
				regulator-name = "buck5";
				regulator-min-microvolt = <700000>;
				regulator-max-microvolt = <1350000>;
				regulator-boot-on;
				regulator-always-on;
			};

			buck6_reg: BUCK6 {
				regulator-name = "buck6";
				regulator-min-microvolt = <3800000>;
				regulator-max-microvolt = <3800000>;
				rohm,dvs-run-voltage = <3800000>;
				regulator-boot-on;
				regulator-always-on;
			};

			buck7_reg: BUCK7 {
				regulator-name = "buck7";
				regulator-min-microvolt = <1605000>;
				regulator-max-microvolt = <1995000>;
				regulator-boot-on;
				regulator-always-on;
			};

			buck8_reg: BUCK8 {
				regulator-name = "buck8";
				regulator-min-microvolt = <800000>;
				regulator-max-microvolt = <1400000>;
				regulator-boot-on;
				regulator-always-on;
			};

			ldo1_reg: LDO1 {
				regulator-name = "ldo1";
				regulator-min-microvolt = <3000000>;
				regulator-max-microvolt = <3300000>;
				regulator-boot-on;
				/* leave on for snvs power button */
				regulator-always-on;
			};

			ldo2_reg: LDO2 {
				regulator-name = "ldo2";
				regulator-min-microvolt = <900000>;
				regulator-max-microvolt = <900000>;
				regulator-boot-on;
				/* leave on for snvs power button */
				regulator-always-on;
			};

			ldo3_reg: LDO3 {
				regulator-name = "ldo3";
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <3300000>;
				regulator-boot-on;
				regulator-always-on;
			};

			ldo4_reg: LDO4 {
				regulator-name = "ldo4";
				regulator-min-microvolt = <900000>;
				regulator-max-microvolt = <1800000>;
				regulator-boot-on;
				regulator-always-on;
			};

			ldo5_reg: LDO5 {
				regulator-name = "ldo5";
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <3300000>;
				regulator-always-on;
			};

			ldo6_reg: LDO6 {
				regulator-name = "ldo6";
				regulator-min-microvolt = <900000>;
				regulator-max-microvolt = <1800000>;
				regulator-boot-on;
				regulator-always-on;
			};

			ldo7_reg: LDO7 {
				regulator-name = "ldo7";
				regulator-min-microvolt = <1800000>;
				regulator-max-microvolt = <3300000>;
				regulator-boot-on;
				regulator-always-on;
			};
		};
	};
};

&lcdif {
	status = "okay";
};

&mipi_dsi {
        #address-cells = <1>;
        #size-cells = <0>;
        status = "okay";
	panel@0 {
		compatible = "raydium,rm69091";
		reg = <0>;
		pinctrl-0 = <&sc_elvddss_active>, <&sc_reset_active>;
		pinctrl-names = "default";
		elvddss-gpios = <&gpio1 8 GPIO_ACTIVE_HIGH>;
		reset-gpios = <&gpio1 20 GPIO_ACTIVE_LOW>;
		dsi-lanes = <1>;
		width-mm = <30>;
		height-mm = <40>;
		port {
			panel_in: endpoint {
				remote-endpoint = <&mipi_dsi_out>;
			};
		};
	};

	ports {
		#address-cells = <1>;
		#size-cells = <0>;

		port@0 {
			#address-cells = <1>;
			#size-cells = <0>;
			reg = <0>;
			mipi_dsi_lcdif_in: endpoint@0 {
				reg = <0>;
				remote-endpoint = <&lcdif_mipi_dsi>;
			};
		};

		port@1 {
			reg = <1>;
			mipi_dsi_out: endpoint {
				remote-endpoint = <&panel_in>;
			};
		};
	};
};

&i2c3 {
	status = "okay";
	tsc@24 {
		compatible = "parade,pt_i2c_adapter";
		reg = <0x24>;
		interrupt-parent = <&gpio1>;
		interrupts = <19 0x2>;
		parade,adapter_id = "pt_i2c_adapter";

		parade,core {
			parade,name = "pt_core";

			pinctrl-0 = <&ts_int_active>, <&ts_reset_active>;
			pinctrl-names = "default";
			parade,irq_gpio = <19>;
			parade,rst_gpio = <21>;
			parade,hid_desc_register = <1>;
			/* 
			 * PT_CORE_FLAG_NONE = 0x00
			 * PT_CORE_FLAG_POWEROFF_ON_SLEEP = 0x02
			 * PT_CORE_FLAG_RESTORE_PARAMETERS = 0x04
			 * PT_CORE_FLAG_DEEP_STANDBY = 0x08
			 * PT_CORE_FLAG_SKIP_SYS_SLEEP = 0x10
			 * PT_CORE_FLAG_SKIP_RUNTIME = 0x20
			 * PT_CORE_FLAG_SKIP_RESUME = 0x40
			 */
			parade,flags = <0>;
			/* PT_CORE_EWG_NONE */
			parade,easy_wakeup_gesture = <0>;
			/* 0:AUTO 1:PIP1_ONLY 2:PIP2_CAPABLE*/
			parade,config_dut_generation = <1>;
			/* 0:False 1:True*/
			parade,watchdog_force_stop = <0>;
			/* 
			 * PT_PANEL_ID_DISABLE = 0x00
			 * PT_PANEL_ID_BY_BL  = 0x01
			 * PT_PANEL_ID_BY_SYS_INFO  = 0x02
			 * PT_PANEL_ID_BY_MFG_DATA  = 0x04
			 */
			parade,panel_id_support = <0>;
			/* 0:PIP, 1: Hybrid HID, 2: pure HID */
			parade,protocol_mode = <0>;
			parade,btn_keys = <172 /* KEY_HOMEPAGE */
					   /* previously was KEY_HOME, new Android versions use KEY_HOMEPAGE */
				       139 /* KEY_MENU */
				       158 /* KEY_BACK */
				       217 /* KEY_SEARCH */
				       114 /* KEY_VOLUMEDOWN */
				       115 /* KEY_VOLUMEUP */
				       212 /* KEY_CAMERA */
				       116>; /* KEY_POWER */
			parade,btn_keys-tag = <0>;

			parade,mt {
				parade,name = "pt_mt";
				parade,inp_dev_name = "pt_mt";
				/*
				 * PT_MT_FLAG_NONE = 0x00
				 * PT_MT_FLAG_FLIP = 0x08
				 * PT_MT_FLAG_INV_X = 0x10
				 * PT_MT_FLAG_INV_Y = 0x20
				 * PT_MT_FLAG_VKEYS = 0x40
				 */
				parade,flags = <0x00>; /* PT_MT_FLAG_NONE */
				parade,abs =
					/* ABS_MT_POSITION_X, PT_ABS_MIN_X, PT_ABS_MAX_X, 0, 0 */
					<0x35 0 880 0 0
					/* ABS_MT_POSITION_Y, PT_ABS_MIN_Y, PT_ABS_MAX_Y, 0, 0 */
					0x36 0 1280 0 0
					/* ABS_MT_PRESSURE, PT_ABS_MIN_P, PT_ABS_MAX_P, 0, 0 */
					0x3a 0 255 0 0
					/* PT_IGNORE_VALUE, PT_ABS_MIN_W, PT_ABS_MAX_W, 0, 0 */
					0xffff 0 255 0 0
					/* ABS_MT_TRACKING_ID, PT_ABS_MIN_T, PT_ABS_MAX_T, 0, 0 */
					0x39 0 15 0 0
					/* ABS_MT_TOUCH_MAJOR, 0, 255, 0, 0 */
					0x30 0 255 0 0
					/* ABS_MT_TOUCH_MINOR, 0, 255, 0, 0 */
					0x31 0 255 0 0
					/* ABS_MT_ORIENTATION, -127, 127, 0, 0 */
					0x34 0xffffff81 127 0 0
					/* ABS_MT_TOOL_TYPE, 0, MT_TOOL_MAX, 0, 0 */
					0x37 0 1 0 0
					/* ABS_DISTANCE, 0, 255, 0, 0 */
					0x19 0 255 0 0>;

				parade,vkeys_x = <720>;
				parade,vkeys_y = <1280>;

				parade,virtual_keys = /* KeyCode CenterX CenterY Width Height */
					/* KEY_BACK */
					<158 90 1360 160 180
					/* KEY_MENU */
					139 270 1360 160 180
					/* KEY_HOMEPAGE */
					172 450 1360 160 180
					/* KEY SEARCH */
					217 630 1360 160 180>;
			};

			parade,btn {
				parade,name = "pt_btn";

				parade,inp_dev_name = "pt_btn";
			};
			
			parade,pen {
				parade,name = "pt_pen";

				parade,inp_dev_name = "pt_pen";
			};

			parade,proximity {
				parade,name = "pt_proximity";

				parade,inp_dev_name = "pt_proximity";
				parade,abs =
					/* ABS_DISTANCE, PT_PROXIMITY_MIN_VAL, PT_PROXIMITY_MAX_VAL, 0, 0 */
					<0x19 0 1 0 0>;
			};
		};
	};
};

&dphy {
	status = "okay";
};

&pcie0 {
        /delete-property/ vph-supply;

        mwifiex: wifi@0 {
		compatible = "mediatek,88w9098", "pci11ab,2b42", "pci1b4b,2b42";
	};
};

&gpio5 {
        pinctrl-names = "default";
        pinctrl-0 = <&pcie1_wake>;
        pcie1_wake-on-hog {
                gpio-hog;
                gpios = <21 GPIO_ACTIVE_LOW>;
                output-high;
        };
};

&gpio3 {
        pinctrl-names = "default";
        pinctrl-0 = <&wifi_reset>, <&bt_reset>, <&wifi_perst>, <&wifi_disable>, <&bt_wakeup>, <&wifi_pd>;

        wifi-reset-on-hog {
                gpio-hog;
                gpios = <07 GPIO_ACTIVE_LOW>;
                output-high;
        };
        bt-reset-on-hog {
                gpio-hog;
                gpios = <06 GPIO_ACTIVE_LOW>;
                output-high;
        };
        wifi-perst-on-hog {
                gpio-hog;
                gpios = <05 GPIO_ACTIVE_LOW>;
                output-high;
        };
        wifi-disable-on-hog {
                gpio-hog;
                gpios = <04 GPIO_ACTIVE_LOW>;
                output-high;
        };
        bt-wakeup-on-hog {
                gpio-hog;
                gpios = <02 GPIO_ACTIVE_HIGH>;
                output-high;
        };
        wifi-pd-on-hog {
                gpio-hog;
                gpios = <00 GPIO_ACTIVE_LOW>;
                output-high;
        };
};

&iomuxc {
	pcie1_wake: pcie1grp {
		fsl,pins = <
			MX8MQ_IOMUXC_I2C4_SDA_GPIO5_IO21	0x16  /* pcie1 wake Active LOW */
		>;
	};

	wifi_reset: wifigrp {
		fsl,pins = <
			MX8MQ_IOMUXC_NAND_DATA01_GPIO3_IO7	0x16  /* wifi reset Active LOW */
		>;
	};
	bt_reset: btgrp {
		fsl,pins = <
			MX8MQ_IOMUXC_NAND_DATA00_GPIO3_IO6	0x16  /* bt reset Active LOW */
		>;
	};
	wifi_perst: wifigrp {
		fsl,pins = <
			MX8MQ_IOMUXC_NAND_CLE_GPIO3_IO5		0x16  /* wifi perst Active LOW */
		>;
	};
	wifi_disable: wifigrp {
		fsl,pins = <
			MX8MQ_IOMUXC_NAND_CE3_B_GPIO3_IO4	0x16  /* wifi disable Active LOW */
		>;
	};
	bt_wakeup: btgrp {
		fsl,pins = <
			MX8MQ_IOMUXC_NAND_CE1_B_GPIO3_IO2	0xd6  /* bt wakeup Active HIGH */
		>;
	};
	wifi_pd: wifigrp {
		fsl,pins = <
			MX8MQ_IOMUXC_NAND_ALE_GPIO3_IO0		0x16  /* wifi pd Active LOW */
		>;
	};
	pinctrl_pmic: pmicgrp {
		fsl,pins = <
			MX8MQ_IOMUXC_GPIO1_IO07_GPIO1_IO7	0x80  /* PMIC intr Active LOW */
		>;
	};
	sc_elvddss_active: scrngrp {
		fsl,pins = <
			MX8MQ_IOMUXC_GPIO1_IO08_GPIO1_IO8	0xd6  /* BL_ELVDD_EN Active HIGH */
		>;
	};
	sc_reset_active: scrngrp {
		fsl,pins = <
			MX8MQ_IOMUXC_ENET_TD1_GPIO1_IO20	0x16  /* Active LOW */
		>;
	};
	ts_reset_active: tsgrp {
		fsl,pins = <
			MX8MQ_IOMUXC_ENET_TD0_GPIO1_IO21	0x16  /* Active LOW */
		>;
	};
	ts_int_active: tsgrp {
		fsl,pins = <
			MX8MQ_IOMUXC_ENET_TD2_GPIO1_IO19	0x80
		>;
	};
};
